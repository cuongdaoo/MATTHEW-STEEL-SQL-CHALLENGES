# Challenge 3 - Customer Insights

# **Relationship Diagram**
![image](https://github.com/user-attachments/assets/a1351f6a-5a25-4c35-81e2-8e333e5a6268)


# **Data preview**
Customers table:
\
![image](https://github.com/user-attachments/assets/dc46e769-4d61-45c5-bde6-eaaaa66689d7)
\
Orders table:
\
![image](https://github.com/user-attachments/assets/7394b0b0-80fb-4db0-93b5-4363363b2992)
\
Baskets table:
\
![image](https://github.com/user-attachments/assets/671c0234-536b-46b8-8c6b-bad6c0a378d1)
\
Product table:
\
![image](https://github.com/user-attachments/assets/b4a6ea89-f4ea-41f7-aed9-c0feddb4ed50)
\
Contry table:
\
![image](https://github.com/user-attachments/assets/4fd47334-8a93-4cf4-be04-85d58fb41cd2)
\
# **Solutions**

**1. What are the names of all the countries in the country table?**

```sql
select country_name 
from country;
```
Output:
\
![image](https://github.com/user-attachments/assets/90227ec3-c8c2-470b-910d-24f656d2cb52)

**2. What is the total number of customers in the customers table?**

```sql
select count(customer_id) total_number_of_customers 
from customers;
```
Output:
\
![image](https://github.com/user-attachments/assets/c601a011-9876-4aa7-95c8-49a1093978ad)

**3. What is the average age of customers who can receive marketing emails (can_email is set to ‘yes’)?**

```sql
select avg(age) average_age 
from customers
where can_email = 'yes';
```
Output:
\
![image](https://github.com/user-attachments/assets/49960db7-f67c-44f9-8099-348989f2ccce)

**4. How many orders were made by customers aged 30 or older?**

```sql
select count(order_id) amount 
from customers c
join orders o on c.customer_id = o.customer_id
where age >= 30;
```
Output:
\
![image](https://github.com/user-attachments/assets/c7ae2cc0-958a-4940-97d3-d7bf3596735b)

**5. What is the total revenue generated by each product category?**

```sql
select category, sum(price) 
from baskets b
join orders o on b.order_id = o.order_id
join products p on p.product_id = b.product_id
group by category;
```
Output:
\
![image](https://github.com/user-attachments/assets/4d048a22-bc54-413f-909b-2eb60232727b)

**6. What is the average price of products in the ‘food’ category?**

```sql
select category, avg(price) avg_price 
from products
where category = 'food'
group by category;
```
Output:
\
![image](https://github.com/user-attachments/assets/8236a897-0c0d-45f5-8c34-0c3a33ed922c)

**7. How many orders were made in each sales channel (sales_channel column) in the orders table?**

```sql
select sales_channel, count(order_id) amount 
from orders
group by sales_channel;
```
Output:
\
![image](https://github.com/user-attachments/assets/f30ce351-82ad-47ef-b51c-5b6d6b424490)

**8. What is the date of the latest order made by a customer who can receive marketing emails?**

```sql
select c.customer_id, can_email, max(date_shop) latest_date 
from customers c
join orders o on c.customer_id = o.customer_id
where can_email = 'yes'
group by c.customer_id, can_email;
```
Output:
\
![image](https://github.com/user-attachments/assets/e06a6ac5-c916-4cbf-a41d-a6b1a0cc246e)

**9. What is the name of the country with the highest number of orders?**

```sql
select top 1 country_name, count(order_id) amount 
from country c
join orders o on c.country_id = o.country_id
group by country_name
order by amount desc;
```
Output:
\
![image](https://github.com/user-attachments/assets/c61f3fc2-8f81-45c9-9c71-c40fa4b2fec1)

**10. What is the average age of customers who made orders in the ‘vitamins’ product category?**

```sql
select category, avg(age) avg_age 
from customers c
join orders o on o.customer_id = c.customer_id
join baskets b on b.order_id = o.order_id
join products p on p.product_id = b.product_id
where category = 'vitamins'
group by category;
```
Output:
\
![image](https://github.com/user-attachments/assets/161ad498-fa3d-4134-8f37-2743f95cfd1b)




